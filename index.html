<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Markdown + LaTeX Viewer</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
<style>
  body{font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; padding:0; background:#fff}
  #app{max-width:720px; margin:40px auto; padding:0 16px;}
  pre code{white-space:pre-wrap; word-break:break-word}
</style>

<div id="app">Загружаю…</div>

<script src="https://cdn.jsdelivr.net/npm/markdown-it@14/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath@1.0.0/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
<script>
/** ── 1) Декодер Base64url → строка (UTF-8 безопасно) ───────────────────── **/
function fromBase64Url(b64url){
  if(!b64url) return '';
  const b64 = b64url.replace(/-/g,'+').replace(/_/g,'/') + '==='.slice((b64url.length+3)%4);
  const bin = atob(b64);
  const bytes = Uint8Array.from(bin, c => c.charCodeAt(0));
  return new TextDecoder().decode(bytes);
}

/** ── 2) Достаём t= из фрагмента #t=... & другие параметры, если будут ───── **/
const hash = location.hash.startsWith('#') ? location.hash.slice(1) : location.hash;
const params = new URLSearchParams(hash);
const payload = params.get('t') || '';    // Base64url-строка
const mdText = payload
  ? fromBase64Url(payload)
  : String.raw`# Пример
Инлайн: $\alpha_e = p \cdot \alpha_m$

Блок:
$$\alpha_e = p \cdot \alpha_m$$

> Передайте текст через фрагмент URL:
> \`#t=\${Base64url(ваш Markdown)}\`
`;

/** ── 3) Markdown → HTML с LaTeX через KaTeX ─────────────────────────────── **/
const md = window.markdownit({html:false, linkify:true, typographer:true})
  .use(texmath, {engine:katex, delimiters:'dollars', katexOptions:{throwOnError:false}});

document.querySelector('#app').innerHTML = md.render(mdText);
</script>
